generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Permission {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  permission String @unique @db.VarChar(25)
  level      Int    @db.SmallInt

  created_at DateTime @default(now()) @db.Timestamp(6)

  users UserPermission[]
}

model User {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  username String @unique @db.VarChar(255)
  password String @db.VarChar(63)
  jwt      String @db.VarChar(511)
  email    String @unique(map: "unique_email") @db.VarChar(255)

  last_login DateTime @default(now()) @db.Timestamp(6)
  created_at DateTime @default(now()) @db.Timestamp(6)

  unverified_users UnverifiedUser[]
  permissions      UserPermission[]
}

model UserPermission {
  user_id       String @db.Uuid
  permission_id String @db.Uuid

  permission Permission @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user       User       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([user_id, permission_id])
}

model UnverifiedUser {
  user_id  String @db.Uuid
  auth_jwt String @db.VarChar(511)
  user     User   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_user")

  @@id([user_id])
}
